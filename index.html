<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Flipbook con √çndice en Imagen 2</title>
  <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/css/page-flip.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #333;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .flipbook-wrapper {
      position: relative;
      width: 908px;
      height: 1298px;
    }

    #flipbook {
      width: 100%;
      height: 100%;
    }

    .boton-indice {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      z-index: 10;
    }

    .boton-indice:hover {
      background: rgba(0,0,0,0.8);
    }

    .indice-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      display: none;
    }

    .indice-overlay button {
      position: absolute;
      background: rgba(255,255,255,0.05);
      border: none;
      cursor: pointer;
      pointer-events: auto;
    }

    .indice-overlay button:hover {
      background: rgba(255,255,255,0.2);
    }

    #contadorVisitas {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 8px;
      font-family: sans-serif;
      font-size: 14px;
      z-index: 15;
      display: none; /* solo en p√°gina 28 */
    }
  </style>
</head>
<body>
  <div class="flipbook-wrapper">
    <div id="flipbook"></div>

    <button class="boton-indice" onclick="irAPagina(2)">üìñ Ir al √≠ndice</button>

    <div class="indice-overlay" id="indiceOverlay">
      <button style="top:270px; left:100px; width:300px; height:20px;" onclick="irAPagina(3)"></button>
      <button style="top:310px; left:100px; width:300px; height:20px;" onclick="irAPagina(4)"></button>
    </div>

    <div id="contadorVisitas">üëÅÔ∏è Cargando visitas...</div>
  </div>

  <script>
    const flip = new St.PageFlip(
      document.getElementById("flipbook"),
      {
        width: 908,
        height: 1298,
        size: "stretch",
        autoCenter: true,
        showCover: false,
        usePortrait: true,
        minWidth: 908,
        maxWidth: 908,
        minHeight: 400,
        maxHeight: 1298,
      }
    );

    const paginas = [
      "img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg","img/5.jpg",
      "img/6.jpg","img/7.jpg","img/8.jpg","img/9.jpg","img/10.jpg",
      "img/11.jpg","img/12.jpg","img/13.jpg","img/14.jpg","img/15.jpg",
      "img/16.jpg","img/17.jpg","img/18.jpg","img/19.jpg","img/20.jpg",
      "img/21.jpg","img/22.jpg","img/23.jpg","img/24.jpg","img/25.jpg",
      "img/26.jpg","img/27.jpg","img/28.jpg"
    ];

    flip.loadFromImages(paginas);

    let contadorActual = 0; // guardar√° el n√∫mero actual

    // Incrementamos el contador apenas alguien entra al sitio
    window.addEventListener("load", async () => {
      contadorActual = await incrementarContador();
    });

    flip.on("flip", (e) => {
      const overlay = document.getElementById("indiceOverlay");
      const contador = document.getElementById("contadorVisitas");

      // √≠ndice en p√°gina 2
      overlay.style.display = (e.data === 1) ? "block" : "none";

      // contador en p√°gina 28
      if (e.data === 27) {
        contador.style.display = "block";
        contador.innerText = "üëÅÔ∏è Visitas: " + contadorActual;
      } else {
        contador.style.display = "none";
      }
    });

    function irAPagina(num) {
      flip.turnToPage(num - 1);
    }

    // üîπ Funci√≥n para incrementar contador en CounterAPI
    async function incrementarContador() {
      try {
        // Namespace v√°lido (sin puntos ni barras)
        let res = await fetch("https://counterapi.dev/api/faromail-github-io-SurMendoza0925/visitas/up");
        let data = await res.json();
        return data.count;
      } catch (e) {
        console.error("Error contador:", e);
        return 0;
      }
    }
  </script>
</body>
</html>
